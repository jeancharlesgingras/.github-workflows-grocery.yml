name: OnDemand-Group-C

on:
  schedule:
    - cron: '10 * * * *'   # every hour at :10 UTC
  workflow_dispatch:

concurrency:
  group: ondemand
  cancel-in-progress: false

jobs:
  run_cat_group_c:
    runs-on: ubuntu-latest
    steps:
      - name: Run ONE category per run (rotating) (limit=650)
        shell: bash
        run: |
          set -euo pipefail

          # Group C categories (edit these to YOUR exact list)
          declare -a cats=(
            "Home Storage & Organization|2224199011"
            "Home Décor|2224027011"
            "Patio Furniture & Accessories|2224159011"
            "Outdoor Décor|2224158011"
            "Garden Structures & Germination Equipment|2224149011"
            "Outdoor Cooking|6257202011"
            "Sports Fan Shop|2406064011"
          )

          # Rotate based on hour so it picks a different one each run
          IDX=$(( ( $(date -u +%s) / 3600 ) % ${#cats[@]} ))
          ENTRY="${cats[$IDX]}"
          LABEL="${ENTRY%%|*}"
          CATID="${ENTRY##*|}"

          echo "[$(date -u)] Running Group-C: $LABEL ($CATID)"

          # Call your existing webapp + secret (same as A)
          http_code=$(curl -sS --fail-with-body \
            -o /tmp/resp.txt -w "%{http_code}" \
            "${{ secrets.OND_WEBAPP }}?secret=${{ secrets.OND_SECRET }}&task=cat:${CATID}&limit=650" \
            || echo "000")

          if [[ "$http_code" != "200" ]]; then
            echo "::warning::HTTP $http_code for '$LABEL'"
            echo "Response (last 50 lines):"
            tail -n 50 /tmp/resp.txt || true
            exit 1
          fi

          echo "OK (200) for '$LABEL'"
