name: OnDemand-Group-D

on:
  schedule:
    - cron: '35 * * * *'   # every hour at :35
  workflow_dispatch:

jobs:
  run_cat_group_d:
    runs-on: ubuntu-latest

    steps:
      - name: Run ONE category per run (limit=650)
        run: |
          set -euo pipefail

          CATS=(
            "Home & Kitchen|2206275011"
            "Office Products|6205511011"
            "Pet Supplies|6205514011"
            "Sports & Outdoors|2242989011"
            "Tools & Home Improvement|3006902011"
            "Toys & Games|6205517011"
          )

          IDX=$(( ( $(date +%s) / 3600 ) % ${#CATS[@]} ))
          ENTRY=${CATS[$IDX]}

          LABEL=${ENTRY%%|*}
          CATID=${ENTRY##*|}

          echo "Running $LABEL ($CATID)"

          curl -s "${{ secrets.ONDEMAND_URL }}?secret=${{ secrets.ONDEMAND_SECRET }}&task=cat:$CATID&limit=650"
